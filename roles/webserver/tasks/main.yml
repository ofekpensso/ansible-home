---
# tasks file for webserver
- name: Install required packages
  dnf:
    name: "{{ item }}"     
    state: latest
    allowerasing: true
  loop: "{{ server_packages }}"  

- name: Ensure the service is running
  service:
    name: nginx
    enabled: true
    state: started

- name: Deploy dynamic index.html
  template:
    src: index.html.j2
    dest: /usr/share/nginx/html/index.html
    mode: "0644"
  notify: Restart nginx
 
- name: Create maintenance alert file
  copy:
    dest: /usr/share/nginx/html/maintenance.html
    content: "<h1>Server is under maintenance! ðŸš§</h1>"
    mode: "0644"
  when: enable_maintenance == true


- name: Install Docker Python SDK
  pip:
    name:
      - "urllib3<2.0"
      - "requests<2.30.0"
      - docker
    state: present
    extra_args: --ignore-installed --force-reinstall

- name: Run a Test Container on port 8080
  community.docker.docker_container:
    name: my_test_app
    image: nginx:alpine       
    state: started
    restart_policy: always
    ports:
      - "8080:80"             
